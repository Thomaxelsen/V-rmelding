<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <title>Synlig halvkule fra ett punkt på jorden</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #050816;
      color: #f5f5f5;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    canvas {
      background: #02030a;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.9rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 4px 10px;
      border-radius: 4px;
      border: none;
      background: #2563eb;
      color: #fff;
      cursor: pointer;
    }

    button:hover {
      background: #1d4ed8;
    }

    input[type="range"] {
      width: 200px;
    }

    .info {
      font-size: 0.9rem;
      max-width: 760px;
      text-align: center;
      line-height: 1.4;
      color: #e5e7eb;
    }

    label span {
      display: inline-block;
      min-width: 40px;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <canvas id="skyCanvas" width="760" height="520"></canvas>

    <div class="controls">
      <button id="toggleBtn">Pause</button>
      <label>
        Tid på døgnet:
        <input id="timeSlider" type="range" min="0" max="24" step="0.1" value="0" />
        <span id="timeLabel">0,0 t</span>
      </label>
    </div>

    <div class="info">
      Til venstre ser du en «himmelkule» med stjerner sett utenfra. Den lyse halvdelen er den
      delen av universet som er over horisonten og synlig fra ett punkt på jorden. Til høyre
      ser du en jordklode og en observatør-pil. Når «døgnet» går, roterer både jordkloden og
      skillet mellom synlig og skjult del av himmelen – men observatøren ser alltid bare én
      halvkule av universet om gangen.
    </div>
  </div>

  <script>
    const canvas = document.getElementById("skyCanvas");
    const ctx = canvas.getContext("2d");

    const w = canvas.width;
    const h = canvas.height;

    // Himmelkule (venstre)
    const skyCx = w * 0.3;
    const skyCy = h / 2;
    const skyR = 210;

    // Jordklode (høyre)
    const earthCx = w * 0.75;
    const earthCy = h / 2;
    const earthR = 80;

    // Stjerner
    const NUM_STARS = 500;
    const stars = [];

    for (let i = 0; i < NUM_STARS; i++) {
      const r = Math.sqrt(Math.random()) * (skyR - 12);
      const ang = Math.random() * Math.PI * 2;
      const x = skyCx + r * Math.cos(ang);
      const y = skyCy + r * Math.sin(ang);
      stars.push({ x, y });
    }

    // Vinkel som definerer "tid på døgnet"
    let angle = 0;
    let playing = true;

    // Ett døgn på 20 sekunder
    const dayDurationMs = 20000;

    const toggleBtn = document.getElementById("toggleBtn");
    const timeSlider = document.getElementById("timeSlider");
    const timeLabel = document.getElementById("timeLabel");

    let lastTime = performance.now();

    function drawSky() {
      // Bakgrunn
      const grad = ctx.createRadialGradient(
        skyCx, skyCy, 20,
        skyCx, skyCy, skyR + 40
      );
      grad.addColorStop(0, "#0b1120");
      grad.addColorStop(1, "#020617");
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, w, h);

      // Klipp til himmelkulen
      ctx.save();
      ctx.beginPath();
      ctx.arc(skyCx, skyCy, skyR, 0, Math.PI * 2);
      ctx.clip();

      // Normalvektor til horisontplanet (hvilken halvkule som er synlig)
      const nx = Math.cos(angle);
      const ny = Math.sin(angle);

      // Skjult side (stjerner svakt)
      for (const s of stars) {
        const sx = s.x - skyCx;
        const sy = s.y - skyCy;
        const dot = sx * nx + sy * ny;
        if (dot <= 0) {
          ctx.fillStyle = "rgba(148,163,184,0.25)";
          ctx.fillRect(s.x, s.y, 1.5, 1.5);
        }
      }

      // Mørkere slør over skjult halvkule
      ctx.beginPath();
      ctx.moveTo(skyCx, skyCy);
      ctx.arc(
        skyCx,
        skyCy,
        skyR,
        angle + Math.PI / 2,
        angle + (3 * Math.PI) / 2,
        false
      );
      ctx.closePath();
      ctx.fillStyle = "rgba(15,23,42,0.72)";
      ctx.fill();

      // Synlig side (stjerner sterkt)
      for (const s of stars) {
        const sx = s.x - skyCx;
        const sy = s.y - skyCy;
        const dot = sx * nx + sy * ny;
        if (dot > 0) {
          const twinkle = 0.6 + Math.random() * 0.4;
          ctx.fillStyle = "rgba(248,250,252," + twinkle + ")";
          ctx.fillRect(s.x, s.y, 1.8, 1.8);
        }
      }

      // "Horisont-sirkel" (stor sirkel gjennom kule som deler halvkuler)
      const hx1 = skyCx + skyR * Math.cos(angle + Math.PI / 2);
      const hy1 = skyCy + skyR * Math.sin(angle + Math.PI / 2);
      const hx2 = skyCx + skyR * Math.cos(angle + (3 * Math.PI) / 2);
      const hy2 = skyCy + skyR * Math.sin(angle + (3 * Math.PI) / 2);

      ctx.beginPath();
      ctx.moveTo(hx1, hy1);
      ctx.lineTo(hx2, hy2);
      ctx.strokeStyle = "rgba(148,163,184,0.85)";
      ctx.lineWidth = 2;
      ctx.setLineDash([6, 4]);
      ctx.stroke();
      ctx.setLineDash([]);

      ctx.restore();

      // Kant rundt himmelkulen
      ctx.beginPath();
      ctx.arc(skyCx, skyCy, skyR, 0, Math.PI * 2);
      ctx.strokeStyle = "#1e293b";
      ctx.lineWidth = 2;
      ctx.stroke();

      // Tekst
      ctx.fillStyle = "#e5e7eb";
      ctx.font =
        '14px system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
      ctx.textAlign = "center";
      ctx.fillText("Synlig halvkule (over horisonten)", skyCx, skyCy - skyR - 16);
      ctx.fillText("Skjult bak jorden", skyCx, skyCy + skyR + 18);
    }

    function drawEarthAndObserver() {
      // Jordklode
      const eg = ctx.createRadialGradient(
        earthCx - earthR * 0.4,
        earthCy - earthR * 0.4,
        earthR * 0.3,
        earthCx,
        earthCy,
        earthR * 1.2
      );
      eg.addColorStop(0, "#38bdf8");
      eg.addColorStop(1, "#0f172a");
      ctx.beginPath();
      ctx.arc(earthCx, earthCy, earthR, 0, Math.PI * 2);
      ctx.fillStyle = eg;
      ctx.fill();

      // Enkel "meridian" for å vise rotasjon
      ctx.beginPath();
      ctx.arc(earthCx, earthCy, earthR * 0.98, 0, Math.PI * 2);
      ctx.strokeStyle = "rgba(15,23,42,0.9)";
      ctx.lineWidth = 2;
      ctx.stroke();

      // Tegn noen grove "kontinenter"
      ctx.save();
      ctx.translate(earthCx, earthCy);
      ctx.rotate(angle);
      ctx.fillStyle = "rgba(34,197,94,0.8)";
      ctx.beginPath();
      ctx.ellipse(-earthR * 0.3, -earthR * 0.1, earthR * 0.35, earthR * 0.22, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.ellipse(earthR * 0.2, earthR * 0.15, earthR * 0.28, earthR * 0.18, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();

      // Observatørposisjon på jordoverflaten
      // Velg en "breddegrad" ~45° nord for illustrasjon
      const lat = (45 * Math.PI) / 180;
      // La longituden følge døgnet (angle)
      const lon = angle;
      // Konverter til 2D (forenkl: bare bruk angle på sirkelen)
      const obsAngle = lon - Math.PI / 2; // roter litt for å få fin plassering

      const ox = earthCx + earthR * Math.cos(obsAngle);
      const oy = earthCy + earthR * Math.sin(obsAngle);

      // Pil som viser "opp" (lokal vertikal)
      const upLen = 35;
      const ux = ox + upLen * Math.cos(obsAngle);
      const uy = oy + upLen * Math.sin(obsAngle);

      // Strek fra jordoverflate til pilspiss
      ctx.beginPath();
      ctx.moveTo(ox, oy);
      ctx.lineTo(ux, uy);
      ctx.strokeStyle = "#fbbf24";
      ctx.lineWidth = 3;
      ctx.stroke();

      // Pilhode
      const headSize = 8;
      const ang = Math.atan2(uy - oy, ux - ox);
      ctx.beginPath();
      ctx.moveTo(ux, uy);
      ctx.lineTo(
        ux - headSize * Math.cos(ang - Math.PI / 6),
        uy - headSize * Math.sin(ang - Math.PI / 6)
      );
      ctx.lineTo(
        ux - headSize * Math.cos(ang + Math.PI / 6),
        uy - headSize * Math.sin(ang + Math.PI / 6)
      );
      ctx.closePath();
      ctx.fillStyle = "#fbbf24";
      ctx.fill();

      // Lite punkt der observatøren står
      ctx.beginPath();
      ctx.arc(ox, oy, 4, 0, Math.PI * 2);
      ctx.fillStyle = "#facc15";
      ctx.fill();
      ctx.lineWidth = 1.5;
      ctx.strokeStyle = "#1e293b";
      ctx.stroke();

      // Rotasjonspil rundt jorden (for å indikere dag/natt-rotasjon)
      const rpR = earthR + 20;
      const start = -Math.PI / 3;
      const end = start + (2 * Math.PI) * 0.7;
      ctx.beginPath();
      ctx.arc(earthCx, earthCy, rpR, start, end);
      ctx.strokeStyle = "rgba(148,163,184,0.8)";
      ctx.lineWidth = 2;
      ctx.stroke();

      const ax = earthCx + rpR * Math.cos(end);
      const ay = earthCy + rpR * Math.sin(end);
      const aDir = end;
      ctx.beginPath();
      ctx.moveTo(ax, ay);
      ctx.lineTo(
        ax - 7 * Math.cos(aDir - Math.PI / 6),
        ay - 7 * Math.sin(aDir - Math.PI / 6)
      );
      ctx.lineTo(
        ax - 7 * Math.cos(aDir + Math.PI / 6),
        ay - 7 * Math.sin(aDir + Math.PI / 6)
      );
      ctx.closePath();
      ctx.fillStyle = "rgba(148,163,184,0.8)";
      ctx.fill();

      // Tekstforklaring
      ctx.fillStyle = "#e5e7eb";
      ctx.font =
        '13px system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
      ctx.textAlign = "center";
      ctx.fillText("Jord", earthCx, earthCy - earthR - 18);
      ctx.fillText("Observatør", ux + 10, uy - 4);
      ctx.textAlign = "left";
      ctx.fillText("Rotasjon →", earthCx + rpR + 12, earthCy);
    }

    function draw() {
      ctx.clearRect(0, 0, w, h);
      drawSky();
      drawEarthAndObserver();
    }

    function update(timestamp) {
      const dt = timestamp - lastTime;
      lastTime = timestamp;

      if (playing) {
        const deltaAngle = (2 * Math.PI) * (dt / dayDurationMs);
        angle = (angle + deltaAngle) % (2 * Math.PI);

        const hours = (angle / (2 * Math.PI)) * 24;
        timeSlider.value = hours.toFixed(1);
        timeLabel.textContent = hours.toFixed(1).replace(".", ",") + " t";
      }

      draw();
      requestAnimationFrame(update);
    }

    // Play/pause
    toggleBtn.addEventListener("click", () => {
      playing = !playing;
      toggleBtn.textContent = playing ? "Pause" : "Spill av";
    });

    // Manuelt valg av tidspunkt
    timeSlider.addEventListener("input", () => {
      const hours = parseFloat(timeSlider.value);
      timeLabel.textContent = hours.toFixed(1).replace(".", ",") + " t";
      angle = (hours / 24) * 2 * Math.PI;
      draw();
    });

    // Start
    draw();
    requestAnimationFrame(update);
  </script>
</body>
</html>